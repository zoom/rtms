name: rtms

x-base: &base
  build: .
  platform: linux/amd64
  cap_add:
    - SYS_PTRACE
  security_opt:
    - seccomp:unconfined
  volumes:
    - .:/tmp/rtms
    - ./logs:/tmp/rtms/logs
  develop:
    watch:
      - action: rebuild
        path: ./
        ignore: 
          - dist
          - logs
          - node_modules
        target: /tmp/rtms
services:
  js:
    <<: *base
    command: npm run build:js && npm run test:js
    ports:
      - 8080:8080
  py:
    <<: *base
    command: npm run build:py && npm run test:py
    ports:
      - 8081:8080
  go:
    <<: *base
    command: npm run build:go && npm run test:go
    ports:
      - 8082:8080