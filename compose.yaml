name: rtms

x-base: &base
  build:
    context: .
    args:
      TARGET: all  # Default to all dependencies
  command: npm install
  platform: linux/amd64
  cap_add:
    - SYS_PTRACE
  security_opt:
    - seccomp:unconfined
  volumes:
    - .:/tmp/rtms
    - ./logs:/tmp/rtms/logs
  develop:
    watch:
      - action: rebuild
        path: ./
        ignore: 
          - dist
          - logs
          - node_modules
        target: /tmp/rtms

services:
  js:
    <<: *base
    build:
      context: .
      args:
        TARGET: js
    ports:
      - 8080:8080
  py:
    <<: *base
    build:
      context: .
      args:
        TARGET: py
    ports:
      - 8081:8080
  go:
    <<: *base
    build:
      context: .
      args:
        TARGET: go
    ports:
      - 8082:8080